{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Enverd\\\\Purwadhika\\\\FrontEnd\\\\bioskopticketing\\\\src\\\\pages\\\\transaction.jsx\";\nimport React from 'react';\nimport { Table } from 'reactstrap';\nimport numeral from 'numeral';\nimport Axios from 'axios';\nimport { Redirect } from 'react-router';\nimport { connect } from 'react-redux';\nimport { Transaksi, updateCart } from './../redux/actions/countActions';\nimport { Link } from 'react-router-dom';\n\nclass Transaction extends React.Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      seat: [],\n      moviename: [],\n      price: 35000,\n      redirect: false,\n      cart: [] //{}\n\n    };\n\n    this.printCart = () => {\n      // Map cart, yang sama \n      // Map di arr \n      var output = this.state.cart.map((value, index) => {\n        return React.createElement(\"tr\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 77\n          },\n          __self: this\n        }, React.createElement(\"td\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 78\n          },\n          __self: this\n        }, index + 1), React.createElement(\"td\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 79\n          },\n          __self: this\n        }, value.movtitle), React.createElement(\"td\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 80\n          },\n          __self: this\n        }, value.seat.join(\",  \") + \"  (Total \" + value.seat.length + \"  Ticket)\"), React.createElement(\"td\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 81\n          },\n          __self: this\n        }, \"Rp \" + numeral(value.totalprice).format(0, 0)), React.createElement(\"td\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 82\n          },\n          __self: this\n        }, React.createElement(\"input\", {\n          type: \"button\",\n          value: \"DELETE\",\n          className: \"btn  btn-danger btn-sm filtercss\",\n          onClick: () => this.buttonDeleteClick(index),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 82\n          },\n          __self: this\n        })));\n      });\n      return output; // var output = ''\n      // for(var i = 0; i<this.state.cart.length; i++){\n      //     var same = false\n      //     for(var y = 0; y<arrhasil.length; y++){\n      //         if(i === arrhasil[y]){\n      //             same = true\n      //             var arr = [...this.state.cart[i].seat , ...this.state.cart[i+1].seat]\n      //             output = output + `\n      //                 <tr>\n      //                     <td>${i+1}</td>\n      //                     <td>${this.state.cart[i].movtitle}</td>\n      //                     <td>${arr.join(\",  \") + \"  (Total \"+ arr.length+ \"  Ticket)\"}</td>\n      //                     <td>${\"Rp \" + numeral(this.state.cart[i].totalprice + this.state.cart[i+1]).format(0,0)}</td>\n      //                 </tr>\n      //             `\n      //         }\n      //     }\n      //     if(same === false){\n      //         output = output + `\n      //                  <tr>\n      //                     <td>${i+1}</td>\n      //                     <td>${this.state.cart[i].movtitle}</td>\n      //                     <td>${this.state.cart[i].seat.join(\",  \") + \"  (Total \"+ this.state.cart[i].seat.length+ \"  Ticket)\"}</td>\n      //                     <td>${\"Rp \" + numeral(this.state.cart[i].totalprice).format(0,0)}</td>\n      //                  </tr>\n      //         `\n      //     }\n      // }\n      // return output\n    };\n\n    this.buttonDeleteClick = index => {\n      Axios.get('http://localhost:2000/movies?title=' + this.state.cart[index].movtitle).then(res => {\n        console.log(\"Berhasil get movie\");\n        console.log(res.data);\n        var databook = res.data[0].booked;\n\n        for (var i = 0; i < this.state.cart[index].seat.length; i++) {\n          if (databook.indexOf(this.state.cart[index].seat[i]) !== -1) {\n            var location = databook.indexOf(this.state.cart[index].seat[i]);\n            databook.splice(location, 1);\n          }\n        } // databook.filter((val)=>{return val.indexOf(this.state.cart[index].seat === -1)})\n\n\n        console.log(databook);\n        Axios.patch('http://localhost:2000/movies/' + res.data[0].id, {\n          booked: databook\n        }).then(res2 => {\n          var newcart = this.state.cart;\n          newcart.splice(index, 1);\n          this.setState({\n            cart: newcart\n          });\n          Axios.get('http://localhost:2000/users?username=' + this.props.currentUser).then(res3 => {\n            var userdatacart = this.state.cart;\n            Axios.patch('http://localhost:2000/users/' + res3.data[0].id, {\n              cart: userdatacart\n            }).then(res => {\n              window.alert(\"Berhasil Update Cart User\");\n            });\n          }).catch(err => {\n            console.log(err);\n          });\n        });\n      }).catch(err => {});\n    };\n\n    this.mapTotal = () => {\n      var total = 0;\n      this.state.cart.map(val => {\n        total = total + val.totalprice;\n      });\n      return total;\n    };\n\n    this.onCheckOut = () => {\n      if (this.props.saldouser < this.mapTotal()) {\n        return window.alert(\"Saldo Belum Mencukupi, Top Up Terlebih Dahulu\");\n      } //post ke movie\n      // var booked = this.props.location.state.booked (dari data)\n      // booked.push([])\n      // Axion.patch('http://localhost:2000/movies'+this.props.location.state.id, {booked : booked})\n      //.then((res)=>{})\n      //.catch((err)=>{})\n      // console.log([...arr1, ...arr2]) arr1 + arr2 \n\n\n      Axios.get('http://localhost:2000/users?username=' + this.props.currentUser).then(res => {\n        // var usercart = res.data[0].cart\n        var usercart = this.state.cart;\n        var cTransaction = res.data[0].transaction;\n        var transaction = [...cTransaction, ...usercart];\n        Axios.patch('http://localhost:2000/users/' + res.data[0].id, {\n          transaction: transaction\n        }).then(res2 => {\n          var kosong = [];\n          var saldofinal = this.props.saldouser - this.mapTotal();\n          this.props.Transaksi(-this.mapTotal());\n          Axios.patch('http://localhost:2000/users/' + res.data[0].id, {\n            cart: kosong,\n            saldo: saldofinal\n          }) // hapus cart\n          .then(res3 => {\n            this.props.updateCart(res3.data.cart.length); // Cart Length Kosong (Update di Redux)\n\n            localStorage.removeItem(\"cartuser\");\n            window.alert(\"Checkout Berhasil\");\n            this.setState({\n              redirect: true\n            });\n          });\n        });\n      }).catch(err => {\n        console.log(err);\n      });\n    };\n  }\n\n  componentDidMount() {\n    // AXIOS get & patch tambah isi cart\n    // Axios.get('http://localhost:2000/users?username='+this.props.currentUser)\n    // .then((res)=>{\n    //     var arr = res.data[0].cart\n    //     var cart = {\n    //         movtitle : this.state.moviename,\n    //         seat : this.state.seat,\n    //         totalprice : this.state.seat.length * this.state.price\n    //     }\n    //     arr.push(cart)\n    //     arr.filter((val) => {return val.seat})\n    //     console.log(\"dapet user\")\n    //     console.log(arr)\n    //     Axios.patch('http://localhost:2000/users/'+ res.data[0].id, {cart : arr})\n    //     .then((res)=>{\n    //         console.log(\"Berhasil\")\n    //         this.setState({\n    //             cart : arr,\n    //             finishrender : true\n    //         })\n    //     })\n    // })\n    // .catch((err)=>{\n    //     console.log(err)\n    // })\n    Axios.get('http://localhost:2000/users?username=' + this.props.currentUser).then(res => {\n      console.log(res.data[0]);\n      this.setState({\n        cart: res.data[0].cart\n      });\n      this.props.updateCart(res.data[0].cart.length);\n    }).catch(err => {\n      console.log(err);\n    });\n  }\n\n  render() {\n    if (this.state.redirect === true) {\n      return React.createElement(Redirect, {\n        to: \"/\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 228\n        },\n        __self: this\n      });\n    }\n\n    if (this.props.IS_LOGGED_IN === false) {\n      return React.createElement(Redirect, {\n        to: \"/pages/loginPage\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 234\n        },\n        __self: this\n      });\n    }\n\n    return React.createElement(\"div\", {\n      className: \"mycontainer\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 239\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"text-center filtercss mt-5\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 240\n      },\n      __self: this\n    }, \" YOUR CART\"), React.createElement(Table, {\n      dark: true,\n      className: \"mt-1\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 241\n      },\n      __self: this\n    }, React.createElement(\"thead\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 243\n      },\n      __self: this\n    }, React.createElement(\"tr\", {\n      className: \"filtercss\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 244\n      },\n      __self: this\n    }, React.createElement(\"td\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 245\n      },\n      __self: this\n    }, \"No\"), React.createElement(\"td\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 246\n      },\n      __self: this\n    }, \"Movie Name\"), React.createElement(\"td\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 247\n      },\n      __self: this\n    }, \"Seat Number\"), React.createElement(\"td\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 248\n      },\n      __self: this\n    }, \"Price\"), React.createElement(\"td\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 249\n      },\n      __self: this\n    }, \"actions\"))), React.createElement(\"tbody\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 252\n      },\n      __self: this\n    }, this.printCart(), this.state.cart.length !== 0 ? React.createElement(\"tr\", {\n      className: \"filtercss text-success\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 258\n      },\n      __self: this\n    }, React.createElement(\"td\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 259\n      },\n      __self: this\n    }), React.createElement(\"td\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 260\n      },\n      __self: this\n    }), React.createElement(\"td\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 261\n      },\n      __self: this\n    }, \"Total Price : \"), React.createElement(\"td\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 262\n      },\n      __self: this\n    }, \"Rp \" + numeral(this.mapTotal()).format(0, 0))) : null), React.createElement(\"tfoot\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 272\n      },\n      __self: this\n    })), this.state.cart.length === 0 ? React.createElement(\"div\", {\n      className: \"alert alert-secondary text-center\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 277\n      },\n      __self: this\n    }, \" YOUR CART IS STILL EMPTY \", React.createElement(\"span\", {\n      style: {\n        fontWeight: \"bolder\"\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 277\n      },\n      __self: this\n    }, \" \")) : null, this.state.cart.length !== 0 ? React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 284\n      },\n      __self: this\n    }, React.createElement(Link, {\n      to: \"/\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 285\n      },\n      __self: this\n    }, React.createElement(\"input\", {\n      type: \"button\",\n      className: \"form-control btn-lg btn filtercss mt-3\",\n      value: \"BUY MORE TICKET\",\n      style: {\n        backgroundColor: \"#c02c3a\"\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 286\n      },\n      __self: this\n    })), React.createElement(\"input\", {\n      type: \"button\",\n      className: \"form-control btn-lg btn btn-success filtercss mt-3\",\n      value: \"CHECKOUT\",\n      onClick: () => this.onCheckOut(),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 288\n      },\n      __self: this\n    })) : React.createElement(\"input\", {\n      type: \"text\",\n      className: \"form-control btn-lg  btn-secondary filtercss mt-3 text-center\",\n      value: \"Shop First before Checkout!\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 291\n      },\n      __self: this\n    }));\n  }\n\n}\n\nconst mapStateToProps = state => {\n  return {\n    currentUser: state.CURRENT_USER_DATA.currentUser,\n    IS_ADMIN: state.CURRENT_USER_DATA.IS_ADMIN,\n    IS_LOGGED_IN: state.CURRENT_USER_DATA.IS_LOGGED_IN,\n    saldouser: state.CURRENT_USER_DATA.saldo,\n    cartlength: state.CURRENT_USER_DATA.cartlength\n  };\n};\n\nexport default connect(mapStateToProps, {\n  Transaksi,\n  updateCart\n})(Transaction); // this.state.cart.map((val, index)=>{\n//     // MASUKIN KE AXIOS TIAP ITEM DI CART\n//     console.log(\"masuk\" + index)\n//     Axios.get('http://localhost:2000/movies?title=' + val.movtitle)\n//     .then((res)=>{\n//         console.log(\"Masuk Movie\")\n//         console.log(res.data)\n//         var seat = val.seat\n//         var booked = res.data[0].booked\n//         booked = [...booked, ...seat]\n//         console.log(booked)\n//         Axios.patch('http://localhost:2000/movies/'+res.data[0].id, {booked : booked })\n//         .then((res2)=>{\n//             console.log(res.data[0].title, \" selesai movie\")\n//             Axios.get('http://localhost:2000/users?username='+this.props.currentUser)\n//             .then((res2)=>{\n//                 var usercart = res2.data[0].transaction\n//                 console.log(val)\n//                 usercart.push(val)\n//                 console.log(usercart)\n//                 //\n//                 var saldo = this.props.saldouser - val.totalprice\n//                 this.props.Transaksi(-(val.totalprice))\n//                 var kosong = []\n//                 Axios.patch('http://localhost:2000/users/'+res2.data[0].id, {transaction : usercart, saldo : saldo, cart : kosong})\n//                 .then((res)=>{\n//                     window.alert(\"checkout berhasil\")\n//                     // DELETE CART\n//                     this.setState({\n//                         redirect : true\n//                     })\n//                 })\n//             })\n//             .catch((err)=>{\n//                 console.log(err)\n//             })\n//         })\n//     })\n//     .catch((err)=>{\n//     })\n// })","map":{"version":3,"sources":["C:\\Users\\Enverd\\Purwadhika\\FrontEnd\\bioskopticketing\\src\\pages\\transaction.jsx"],"names":["React","Table","numeral","Axios","Redirect","connect","Transaksi","updateCart","Link","Transaction","Component","state","seat","moviename","price","redirect","cart","printCart","output","map","value","index","movtitle","join","length","totalprice","format","buttonDeleteClick","get","then","res","console","log","data","databook","booked","i","indexOf","location","splice","patch","id","res2","newcart","setState","props","currentUser","res3","userdatacart","window","alert","catch","err","mapTotal","total","val","onCheckOut","saldouser","usercart","cTransaction","transaction","kosong","saldofinal","saldo","localStorage","removeItem","componentDidMount","render","IS_LOGGED_IN","fontWeight","backgroundColor","mapStateToProps","CURRENT_USER_DATA","IS_ADMIN","cartlength"],"mappings":"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","sourcesContent":["import React from 'react'\r\nimport { Table } from 'reactstrap'\r\nimport numeral from 'numeral'\r\nimport Axios from 'axios';\r\nimport {Redirect} from 'react-router'\r\nimport {connect} from 'react-redux'\r\nimport { Transaksi, updateCart } from './../redux/actions/countActions'\r\nimport {Link } from 'react-router-dom'\r\n\r\n\r\n\r\nclass Transaction extends React.Component{\r\n    state = {\r\n        seat : [],\r\n        moviename : [],\r\n        price : 35000,\r\n        redirect : false,\r\n        cart : [] //{}\r\n        \r\n       \r\n    }\r\n    componentDidMount(){\r\n  \r\n     \r\n        // AXIOS get & patch tambah isi cart\r\n       \r\n        // Axios.get('http://localhost:2000/users?username='+this.props.currentUser)\r\n        // .then((res)=>{\r\n        //     var arr = res.data[0].cart\r\n        //     var cart = {\r\n        //         movtitle : this.state.moviename,\r\n        //         seat : this.state.seat,\r\n        //         totalprice : this.state.seat.length * this.state.price\r\n\r\n        //     }\r\n\r\n        //     arr.push(cart)\r\n        //     arr.filter((val) => {return val.seat})\r\n        //     console.log(\"dapet user\")\r\n        //     console.log(arr)\r\n\r\n        //     Axios.patch('http://localhost:2000/users/'+ res.data[0].id, {cart : arr})\r\n        //     .then((res)=>{\r\n        //         console.log(\"Berhasil\")\r\n        //         this.setState({\r\n        //             cart : arr,\r\n        //             finishrender : true\r\n        //         })\r\n        //     })\r\n        \r\n        // })\r\n        // .catch((err)=>{\r\n        //     console.log(err)\r\n        // })\r\n\r\n        Axios.get('http://localhost:2000/users?username='+this.props.currentUser)\r\n        .then((res)=>{\r\n            console.log(res.data[0])\r\n            this.setState({\r\n                cart : res.data[0].cart\r\n            })\r\n            this.props.updateCart(res.data[0].cart.length)\r\n        })\r\n        .catch((err)=>{\r\n            console.log(err)\r\n        })\r\n    \r\n    }\r\n    printCart = () => {\r\n        // Map cart, yang sama \r\n        // Map di arr \r\n      \r\n        var output = this.state.cart.map((value, index) => {\r\n        \r\n            \r\n            return(\r\n                <tr>\r\n                    <td>{index+1}</td>\r\n                    <td>{value.movtitle}</td>\r\n                    <td>{value.seat.join(\",  \") + \"  (Total \"+ value.seat.length+ \"  Ticket)\"}</td>\r\n                    <td>{\"Rp \" + numeral(value.totalprice).format(0,0)}</td>\r\n                    <td><input type=\"button\" value=\"DELETE\" className=\"btn  btn-danger btn-sm filtercss\" onClick={()=>this.buttonDeleteClick(index)}></input></td>\r\n                </tr>\r\n            \r\n            \r\n            \r\n           \r\n        )\r\n        \r\n    }\r\n    )\r\n        return output\r\n\r\n\r\n        // var output = ''\r\n        // for(var i = 0; i<this.state.cart.length; i++){\r\n        //     var same = false\r\n        //     for(var y = 0; y<arrhasil.length; y++){\r\n        //         if(i === arrhasil[y]){\r\n        //             same = true\r\n        //             var arr = [...this.state.cart[i].seat , ...this.state.cart[i+1].seat]\r\n        //             output = output + `\r\n        //                 <tr>\r\n        //                     <td>${i+1}</td>\r\n        //                     <td>${this.state.cart[i].movtitle}</td>\r\n        //                     <td>${arr.join(\",  \") + \"  (Total \"+ arr.length+ \"  Ticket)\"}</td>\r\n        //                     <td>${\"Rp \" + numeral(this.state.cart[i].totalprice + this.state.cart[i+1]).format(0,0)}</td>\r\n        //                 </tr>\r\n        //             `\r\n        //         }\r\n        //     }\r\n        //     if(same === false){\r\n        //         output = output + `\r\n        //                  <tr>\r\n        //                     <td>${i+1}</td>\r\n        //                     <td>${this.state.cart[i].movtitle}</td>\r\n        //                     <td>${this.state.cart[i].seat.join(\",  \") + \"  (Total \"+ this.state.cart[i].seat.length+ \"  Ticket)\"}</td>\r\n        //                     <td>${\"Rp \" + numeral(this.state.cart[i].totalprice).format(0,0)}</td>\r\n        //                  </tr>\r\n        //         `\r\n        //     }\r\n        // }\r\n        // return output\r\n        \r\n        \r\n    }\r\n\r\n    buttonDeleteClick = (index) =>{\r\n        \r\n\r\n        Axios.get('http://localhost:2000/movies?title='+this.state.cart[index].movtitle)\r\n        .then((res)=>{\r\n            console.log(\"Berhasil get movie\")\r\n            console.log(res.data)\r\n            var databook = res.data[0].booked\r\n            for(var i = 0; i<this.state.cart[index].seat.length; i++){\r\n                if(databook.indexOf(this.state.cart[index].seat[i]) !== -1){\r\n                    var location = databook.indexOf(this.state.cart[index].seat[i])\r\n                    databook.splice(location, 1)\r\n                }   \r\n            }\r\n\r\n            // databook.filter((val)=>{return val.indexOf(this.state.cart[index].seat === -1)})\r\n            console.log(databook)\r\n            Axios.patch('http://localhost:2000/movies/'+res.data[0].id, {booked : databook})\r\n            .then((res2)=>{\r\n                var newcart = this.state.cart\r\n                newcart.splice(index,1)\r\n                this.setState({\r\n                    cart : newcart\r\n                })\r\n      \r\n                Axios.get('http://localhost:2000/users?username='+this.props.currentUser)\r\n                .then((res3)=>{\r\n                    var userdatacart = this.state.cart\r\n                    Axios.patch('http://localhost:2000/users/'+res3.data[0].id, {cart : userdatacart})\r\n                    .then((res)=>{\r\n                        window.alert(\"Berhasil Update Cart User\")\r\n                    })\r\n\r\n                })\r\n                .catch((err)=>{\r\n                    console.log(err)\r\n                })\r\n            })\r\n        })\r\n        .catch((err)=>{\r\n\r\n        })\r\n\r\n        \r\n    }\r\n\r\n    mapTotal = () =>{\r\n        var total = 0\r\n        this.state.cart.map((val)=> {\r\n            total = total + val.totalprice\r\n        })\r\n        return total\r\n    }\r\n\r\n    onCheckOut = () => {\r\n        if(this.props.saldouser < (this.mapTotal())){\r\n            return window.alert(\"Saldo Belum Mencukupi, Top Up Terlebih Dahulu\")\r\n        }\r\n        //post ke movie\r\n        // var booked = this.props.location.state.booked (dari data)\r\n        // booked.push([])\r\n        // Axion.patch('http://localhost:2000/movies'+this.props.location.state.id, {booked : booked})\r\n        //.then((res)=>{})\r\n        //.catch((err)=>{})\r\n        // console.log([...arr1, ...arr2]) arr1 + arr2 \r\n   \r\n        Axios.get('http://localhost:2000/users?username='+this.props.currentUser)\r\n        .then((res)=>{\r\n            // var usercart = res.data[0].cart\r\n            var usercart = this.state.cart\r\n            var cTransaction = res.data[0].transaction\r\n            var transaction = [...cTransaction, ...usercart]\r\n            Axios.patch('http://localhost:2000/users/'+res.data[0].id, {transaction : transaction})\r\n            .then((res2)=>{\r\n                var kosong = []\r\n                \r\n                var saldofinal = this.props.saldouser - this.mapTotal()\r\n                this.props.Transaksi(-(this.mapTotal()))\r\n                Axios.patch('http://localhost:2000/users/'+res.data[0].id, {cart : kosong, saldo : saldofinal}) // hapus cart\r\n                .then((res3)=>{\r\n\r\n                    this.props.updateCart(res3.data.cart.length) // Cart Length Kosong (Update di Redux)\r\n                    localStorage.removeItem(\"cartuser\")\r\n                    window.alert(\"Checkout Berhasil\")\r\n                    this.setState({\r\n                        redirect : true\r\n                    })\r\n                    \r\n                })\r\n            })\r\n        })\r\n        .catch((err)=>{\r\n            console.log(err)\r\n        })\r\n        \r\n        \r\n    }\r\n    render(){\r\n        if(this.state.redirect === true){\r\n            return(\r\n                <Redirect to=\"/\"></Redirect>\r\n            )\r\n            \r\n        }\r\n        if(this.props.IS_LOGGED_IN === false){\r\n            return(\r\n                <Redirect to='/pages/loginPage'></Redirect>\r\n            )\r\n        }\r\n        return(\r\n            \r\n                <div className=\"mycontainer\">\r\n                    <div className=\"text-center filtercss mt-5\"> YOUR CART</div>\r\n                   <Table dark className=\"mt-1\">\r\n                   \r\n                       <thead>\r\n                            <tr className=\"filtercss\">\r\n                                <td>No</td>\r\n                                <td>Movie Name</td>\r\n                                <td>Seat Number</td>\r\n                                <td>Price</td>\r\n                                <td>actions</td>\r\n                            </tr>\r\n                       </thead>\r\n                       <tbody>\r\n                            {this.printCart()}\r\n                           {this.state.cart.length !== 0 \r\n                           ? \r\n                          \r\n                    \r\n                           <tr className=\"filtercss text-success\"> \r\n                                <td></td>\r\n                                <td></td>\r\n                                <td>Total Price : </td>\r\n                                <td>{\"Rp \" + numeral(this.mapTotal()).format(0,0)}</td>\r\n                            </tr>\r\n                          \r\n                         \r\n                            :\r\n                            null\r\n                           }\r\n                            \r\n                            \r\n                       </tbody>\r\n                       <tfoot></tfoot>\r\n                       \r\n                   </Table>\r\n                    {this.state.cart.length === 0 \r\n                    ? \r\n                    <div className='alert alert-secondary text-center'> YOUR CART IS STILL EMPTY <span style={{fontWeight : \"bolder\"}} > </span></div>\r\n                    :\r\n                    null\r\n                \r\n                }\r\n                {this.state.cart.length !== 0\r\n                ?\r\n                <div>\r\n                <Link to=\"/\">\r\n                <input type=\"button\" className=\"form-control btn-lg btn filtercss mt-3\" value=\"BUY MORE TICKET\" style={{backgroundColor : \"#c02c3a\"}}></input>\r\n                </Link>\r\n                <input type=\"button\" className=\"form-control btn-lg btn btn-success filtercss mt-3\" value=\"CHECKOUT\" onClick={()=>this.onCheckOut()}></input>\r\n                </div>\r\n                :\r\n                <input type=\"text\" className=\"form-control btn-lg  btn-secondary filtercss mt-3 text-center\" value=\"Shop First before Checkout!\" ></input>\r\n                }\r\n                   \r\n                   </div>\r\n               \r\n            \r\n        )\r\n    }\r\n}\r\n\r\nconst mapStateToProps = (state) => {\r\n    return{\r\n       currentUser : state.CURRENT_USER_DATA.currentUser,\r\n       IS_ADMIN : state.CURRENT_USER_DATA.IS_ADMIN,\r\n       IS_LOGGED_IN : state.CURRENT_USER_DATA.IS_LOGGED_IN,\r\n       saldouser : state.CURRENT_USER_DATA.saldo,\r\n       cartlength : state.CURRENT_USER_DATA.cartlength\r\n    }\r\n}\r\nexport default connect(mapStateToProps, {Transaksi, updateCart})(Transaction);\r\n\r\n// this.state.cart.map((val, index)=>{\r\n        //     // MASUKIN KE AXIOS TIAP ITEM DI CART\r\n        //     console.log(\"masuk\" + index)\r\n        //     Axios.get('http://localhost:2000/movies?title=' + val.movtitle)\r\n        //     .then((res)=>{\r\n        //         console.log(\"Masuk Movie\")\r\n        //         console.log(res.data)\r\n        //         var seat = val.seat\r\n        //         var booked = res.data[0].booked\r\n        //         booked = [...booked, ...seat]\r\n        //         console.log(booked)\r\n        //         Axios.patch('http://localhost:2000/movies/'+res.data[0].id, {booked : booked })\r\n        //         .then((res2)=>{\r\n        //             console.log(res.data[0].title, \" selesai movie\")\r\n        //             Axios.get('http://localhost:2000/users?username='+this.props.currentUser)\r\n        //             .then((res2)=>{\r\n        //                 var usercart = res2.data[0].transaction\r\n        //                 console.log(val)\r\n        //                 usercart.push(val)\r\n        //                 console.log(usercart)\r\n                       \r\n\r\n\r\n        //                 //\r\n        //                 var saldo = this.props.saldouser - val.totalprice\r\n        //                 this.props.Transaksi(-(val.totalprice))\r\n        //                 var kosong = []\r\n        //                 Axios.patch('http://localhost:2000/users/'+res2.data[0].id, {transaction : usercart, saldo : saldo, cart : kosong})\r\n        //                 .then((res)=>{\r\n        //                     window.alert(\"checkout berhasil\")\r\n        //                     // DELETE CART\r\n        //                     this.setState({\r\n        //                         redirect : true\r\n        //                     })\r\n                        \r\n        //                 })\r\n        //             })\r\n        //             .catch((err)=>{\r\n        //                 console.log(err)\r\n        //             })\r\n        //         })\r\n        //     })\r\n        //     .catch((err)=>{\r\n\r\n        //     })\r\n        // })\r\n"]},"metadata":{},"sourceType":"module"}