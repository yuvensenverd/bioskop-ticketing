{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Enverd\\\\Purwadhika\\\\FrontEnd\\\\bioskopticketing\\\\src\\\\pages\\\\transaction.jsx\";\nimport React from 'react';\nimport { Table } from 'reactstrap';\nimport numeral from 'numeral';\nimport Axios from 'axios';\nimport { Redirect } from 'react-router';\nimport { connect } from 'react-redux';\nimport { Transaksi } from './../redux/actions/countActions';\n\nclass Transaction extends React.Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      seat: [],\n      moviename: [],\n      price: 35000,\n      redirect: false,\n      cart: [],\n      finishrender: false\n    };\n\n    this.printCart = () => {\n      var output = this.state.cart.map((value, index) => {\n        return React.createElement(\"tr\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 63\n          },\n          __self: this\n        }, React.createElement(\"td\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 64\n          },\n          __self: this\n        }, index + 1), React.createElement(\"td\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 65\n          },\n          __self: this\n        }, value.movtitle), React.createElement(\"td\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 66\n          },\n          __self: this\n        }, value.seat.join(\",  \")), React.createElement(\"td\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 67\n          },\n          __self: this\n        }, \"Rp \" + numeral(value.totalprice).format(0, 0)));\n      });\n      return output;\n    };\n\n    this.mapTotal = () => {\n      var total = 0;\n      this.state.cart.map(val => {\n        total = total + val.totalprice;\n      });\n      return total;\n    };\n\n    this.onCheckOut = () => {\n      if (this.props.saldouser < this.state.seat.length * this.state.price) {\n        return window.alert(\"Saldo Belum Mencukupi, Top Up Terlebih Dahulu\");\n      } //post ke movie\n      // var booked = this.props.location.state.booked (dari data)\n      // booked.push([])\n      // Axion.patch('http://localhost:2000/movies'+this.props.location.state.id, {booked : booked})\n      //.then((res)=>{})\n      //.catch((err)=>{})\n      // console.log([...arr1, ...arr2]) arr1 + arr2 \n\n\n      Axios.get('http://localhost:2000/movies?title=' + this.state.moviename).then(res => {\n        var seat = this.state.seat;\n        console.log(res.data[0].booked);\n\n        for (var i = 0; i < seat.length; i++) {\n          res.data[0].booked.push(seat[i]);\n        }\n\n        console.log(res.data[0].booked);\n        Axios.put('http://localhost:2000/movies/' + res.data[0].id, res.data[0]).then(result => {\n          console.log(result.data);\n          Axios.get('http://localhost:2000/users?username=' + this.props.currentUser).then(rez => {\n            console.log(\"get user\");\n            var transaction = {\n              movtitle: res.data[0].title,\n              ticket: this.state.seat.length,\n              totalprice: this.state.seat.length * this.state.price\n            };\n            var restransaction = rez.data[0].transaction;\n            restransaction.push(transaction);\n            rez.data[0].saldo = this.props.saldouser - this.state.seat.length * this.state.price;\n            rez.data[0].transaction = restransaction;\n            Axios.put('http://localhost:2000/users/' + rez.data[0].id, rez.data[0]).then(finalres => {\n              console.log(\"put user berhasil\");\n              window.alert(\"Checkout Berhasil\");\n              this.setState({\n                redirect: true\n              });\n              this.props.Transaksi(-this.mapTotal());\n              console.log(finalres);\n            }).catch(err4 => {\n              console.log(err4);\n            });\n          }).catch(err3 => {\n            console.log(err3);\n          });\n        }).catch(err2 => {\n          console.log(err2);\n        });\n      }).catch(err => {\n        console.log(err);\n      });\n    };\n  }\n\n  componentDidMount() {\n    var listseat = this.props.location.state.seatnumber;\n    var moviename = this.props.location.state.moviename;\n    console.log(moviename);\n    this.setState({\n      seat: listseat,\n      moviename: moviename\n    }); // AXIOS get & patch tambah isi cart\n\n    if (this.state.finishrender === false) {\n      Axios.get('http://localhost:2000/users?username=' + this.props.currentUser).then(res => {\n        var arr = res.data[0].cart;\n        var cart = {\n          movtitle: this.state.moviename,\n          seat: this.state.seat,\n          totalprice: this.state.seat.length * this.state.price\n        };\n        arr.push(cart);\n        console.log(\"dapet user\");\n        console.log(arr);\n        Axios.patch('http://localhost:2000/users/' + res.data[0].id, {\n          cart: arr\n        }).then(res => {\n          console.log(\"Berhasil\");\n          this.setState({\n            cart: arr,\n            finishrender: true\n          });\n        });\n      }).catch(err => {\n        console.log(err);\n      });\n    }\n  }\n\n  render() {\n    if (this.state.redirect === true) {\n      return React.createElement(Redirect, {\n        to: \"/\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 150\n        },\n        __self: this\n      });\n    }\n\n    return React.createElement(\"div\", {\n      className: \"mycontainer\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 156\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"text-center filtercss mt-5\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 157\n      },\n      __self: this\n    }, \" YOUR CART\"), React.createElement(Table, {\n      dark: true,\n      className: \"mt-1\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 158\n      },\n      __self: this\n    }, React.createElement(\"thead\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 160\n      },\n      __self: this\n    }, React.createElement(\"tr\", {\n      className: \"filtercss\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 161\n      },\n      __self: this\n    }, React.createElement(\"td\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 162\n      },\n      __self: this\n    }, \"No\"), React.createElement(\"td\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 163\n      },\n      __self: this\n    }, \"Movie Name\"), React.createElement(\"td\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 164\n      },\n      __self: this\n    }, \"Seat Number\"), React.createElement(\"td\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 165\n      },\n      __self: this\n    }, \"Price\"))), React.createElement(\"tbody\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 168\n      },\n      __self: this\n    }, this.printCart(), React.createElement(\"tr\", {\n      className: \"filtercss text-success\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 171\n      },\n      __self: this\n    }, React.createElement(\"td\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 172\n      },\n      __self: this\n    }), React.createElement(\"td\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 173\n      },\n      __self: this\n    }), React.createElement(\"td\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 174\n      },\n      __self: this\n    }, \"Total Price : \"), React.createElement(\"td\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 175\n      },\n      __self: this\n    }, \"Rp \" + numeral(this.mapTotal()).format(0, 0))), React.createElement(\"tr\", {\n      className: \"filtercss\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 177\n      },\n      __self: this\n    }, React.createElement(\"td\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 178\n      },\n      __self: this\n    }), React.createElement(\"td\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 179\n      },\n      __self: this\n    }), React.createElement(\"td\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 180\n      },\n      __self: this\n    }, \"Saldo Anda \"), React.createElement(\"td\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 181\n      },\n      __self: this\n    }, \"Rp \" + numeral(this.props.saldouser).format(0, 0)))), React.createElement(\"tfoot\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 185\n      },\n      __self: this\n    })), React.createElement(\"input\", {\n      type: \"button\",\n      className: \"form-control btn-lg btn btn-success filtercss\",\n      value: \"CHECKOUT\",\n      onClick: () => this.onCheckOut(),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 188\n      },\n      __self: this\n    }));\n  }\n\n}\n\nconst mapStateToProps = state => {\n  return {\n    currentUser: state.CURRENT_USER_DATA.currentUser,\n    IS_ADMIN: state.CURRENT_USER_DATA.IS_ADMIN,\n    IS_LOGGED_IN: state.CURRENT_USER_DATA.IS_LOGGED_IN,\n    saldouser: state.CURRENT_USER_DATA.saldo\n  };\n};\n\nexport default connect(mapStateToProps, {\n  Transaksi\n})(Transaction);","map":{"version":3,"sources":["C:\\Users\\Enverd\\Purwadhika\\FrontEnd\\bioskopticketing\\src\\pages\\transaction.jsx"],"names":["React","Table","numeral","Axios","Redirect","connect","Transaksi","Transaction","Component","state","seat","moviename","price","redirect","cart","finishrender","printCart","output","map","value","index","movtitle","join","totalprice","format","mapTotal","total","val","onCheckOut","props","saldouser","length","window","alert","get","then","res","console","log","data","booked","i","push","put","id","result","currentUser","rez","transaction","title","ticket","restransaction","saldo","finalres","setState","catch","err4","err3","err2","err","componentDidMount","listseat","location","seatnumber","arr","patch","render","mapStateToProps","CURRENT_USER_DATA","IS_ADMIN","IS_LOGGED_IN"],"mappings":"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","sourcesContent":["import React from 'react'\r\nimport { Table } from 'reactstrap'\r\nimport numeral from 'numeral'\r\nimport Axios from 'axios';\r\nimport {Redirect} from 'react-router'\r\nimport {connect} from 'react-redux'\r\nimport { Transaksi } from './../redux/actions/countActions'\r\n\r\n\r\n\r\nclass Transaction extends React.Component{\r\n    state = {\r\n        seat : [],\r\n        moviename : [],\r\n        price : 35000,\r\n        redirect : false,\r\n        cart : [],\r\n        finishrender : false\r\n       \r\n    }\r\n    componentDidMount(){\r\n        var listseat = this.props.location.state.seatnumber\r\n        var moviename = this.props.location.state.moviename\r\n        console.log(moviename)\r\n        this.setState({\r\n            seat : listseat,\r\n            moviename : moviename\r\n        })\r\n        // AXIOS get & patch tambah isi cart\r\n        if(this.state.finishrender === false){\r\n        Axios.get('http://localhost:2000/users?username='+this.props.currentUser)\r\n        .then((res)=>{\r\n            var arr = res.data[0].cart\r\n            var cart = {\r\n                movtitle : this.state.moviename,\r\n                seat : this.state.seat,\r\n                totalprice : this.state.seat.length * this.state.price\r\n\r\n            }\r\n\r\n            arr.push(cart)\r\n            console.log(\"dapet user\")\r\n            console.log(arr)\r\n\r\n            Axios.patch('http://localhost:2000/users/'+ res.data[0].id, {cart : arr})\r\n            .then((res)=>{\r\n                console.log(\"Berhasil\")\r\n                this.setState({\r\n                    cart : arr,\r\n                    finishrender : true\r\n                })\r\n            })\r\n        \r\n        })\r\n        .catch((err)=>{\r\n            console.log(err)\r\n        })\r\n    }\r\n    }\r\n    printCart = () => {\r\n        var output = this.state.cart.map((value, index) => {\r\n            return(\r\n                <tr>\r\n                    <td>{index+1}</td>\r\n                    <td>{value.movtitle}</td>\r\n                    <td>{value.seat.join(\",  \")}</td>\r\n                    <td>{\"Rp \" + numeral(value.totalprice).format(0,0)}</td>\r\n                </tr>\r\n            )\r\n        })\r\n        return output\r\n    }\r\n\r\n    mapTotal = () =>{\r\n        var total = 0\r\n        this.state.cart.map((val)=> {\r\n            total = total + val.totalprice\r\n        })\r\n        return total\r\n    }\r\n\r\n    onCheckOut = () => {\r\n        if(this.props.saldouser < (this.state.seat.length * this.state.price)){\r\n            return window.alert(\"Saldo Belum Mencukupi, Top Up Terlebih Dahulu\")\r\n        }\r\n        //post ke movie\r\n        // var booked = this.props.location.state.booked (dari data)\r\n        // booked.push([])\r\n        // Axion.patch('http://localhost:2000/movies'+this.props.location.state.id, {booked : booked})\r\n        //.then((res)=>{})\r\n        //.catch((err)=>{})\r\n        // console.log([...arr1, ...arr2]) arr1 + arr2 \r\n   \r\n        \r\n        Axios.get('http://localhost:2000/movies?title='+this.state.moviename)\r\n        .then((res)=> {\r\n            var seat = this.state.seat\r\n            console.log(res.data[0].booked)\r\n            for(var i = 0; i< seat.length; i++){\r\n                res.data[0].booked.push(seat[i])\r\n            }\r\n            console.log(res.data[0].booked)\r\n           \r\n            Axios.put('http://localhost:2000/movies/' + res.data[0].id, res.data[0])\r\n            .then((result) => {\r\n                \r\n                console.log(result.data)\r\n                Axios.get('http://localhost:2000/users?username='+this.props.currentUser)\r\n                .then((rez)=>{\r\n                    console.log(\"get user\")\r\n                    var transaction = {\r\n                        movtitle : res.data[0].title ,\r\n                        ticket : this.state.seat.length,\r\n                        totalprice : this.state.seat.length * this.state.price\r\n                    }\r\n                    var restransaction = rez.data[0].transaction\r\n                    restransaction.push(transaction)\r\n                    rez.data[0].saldo = this.props.saldouser - (this.state.seat.length * this.state.price)\r\n                    rez.data[0].transaction = restransaction\r\n\r\n                    Axios.put('http://localhost:2000/users/'+ rez.data[0].id, rez.data[0])\r\n                    .then((finalres)=>{\r\n                        console.log(\"put user berhasil\")\r\n                        window.alert(\"Checkout Berhasil\")\r\n                        this.setState({\r\n                            redirect : true\r\n                        })\r\n                        this.props.Transaksi(-(this.mapTotal()))\r\n                        console.log(finalres)\r\n                   })\r\n                    .catch((err4)=>{\r\n                        console.log(err4)\r\n                    })\r\n                })\r\n                .catch((err3)=>{\r\n                    console.log(err3)\r\n                })\r\n            })\r\n            .catch((err2)=>{\r\n                console.log(err2)\r\n            })\r\n        })\r\n        .catch((err)=>{\r\n            console.log(err)\r\n        })\r\n    }\r\n    render(){\r\n        if(this.state.redirect === true){\r\n            return(\r\n                <Redirect to=\"/\"></Redirect>\r\n            )\r\n            \r\n        }\r\n        return(\r\n            \r\n                <div className=\"mycontainer\">\r\n                    <div className=\"text-center filtercss mt-5\"> YOUR CART</div>\r\n                   <Table dark className=\"mt-1\">\r\n                        \r\n                       <thead>\r\n                            <tr className=\"filtercss\">\r\n                                <td>No</td>\r\n                                <td>Movie Name</td>\r\n                                <td>Seat Number</td>\r\n                                <td>Price</td>\r\n                            </tr>\r\n                       </thead>\r\n                       <tbody>\r\n                            {this.printCart()}\r\n                           \r\n                            <tr className=\"filtercss text-success\"> \r\n                                <td></td>\r\n                                <td></td>\r\n                                <td>Total Price : </td>\r\n                                <td>{\"Rp \" + numeral(this.mapTotal()).format(0,0)}</td>\r\n                            </tr>\r\n                            <tr className=\"filtercss\"> \r\n                                <td></td>\r\n                                <td></td>\r\n                                <td>Saldo Anda </td>\r\n                                <td>{\"Rp \" + numeral(this.props.saldouser).format(0,0)}</td>\r\n                            </tr>\r\n                            \r\n                       </tbody>\r\n                       <tfoot></tfoot>\r\n                       \r\n                   </Table>\r\n                   <input type=\"button\" className=\"form-control btn-lg btn btn-success filtercss\" value=\"CHECKOUT\" onClick={()=>this.onCheckOut()}></input>\r\n                   </div>\r\n               \r\n            \r\n        )\r\n    }\r\n}\r\n\r\nconst mapStateToProps = (state) => {\r\n    return{\r\n       currentUser : state.CURRENT_USER_DATA.currentUser,\r\n       IS_ADMIN : state.CURRENT_USER_DATA.IS_ADMIN,\r\n       IS_LOGGED_IN : state.CURRENT_USER_DATA.IS_LOGGED_IN,\r\n       saldouser : state.CURRENT_USER_DATA.saldo\r\n    }\r\n}\r\nexport default connect(mapStateToProps, {Transaksi})(Transaction);"]},"metadata":{},"sourceType":"module"}