import React from 'react'
import Axios from 'axios'

import { connect } from 'react-redux'
import { logUser } from './../redux/actions/countActions'
import { logAdmin } from './../redux/actions/countActions'
import { Redirect } from 'react-router'
import { Paper } from '@material-ui/core'
import { Link } from 'react-router-dom'
 
class loginPage extends React.Component{
    state = {
        userdata : [],
        redirect : false
    }
    componentDidMount(){
        this.getLoginData()
    }
    getLoginData = () => {
    
        Axios.get('http://localhost:2000/users/')
        .then((res) => {
            console.log(res.data)
            this.setState({
                userdata : res.data
            })
            // console.log("ini userdata state", this.state.userdata)
            
        })
        .catch((err) => {
            console.log(err)
        })
    }

    validateUser = () => {
        var userid = this.refs.userIdLog.value
        var userpass = this.refs.userPassLog.value
        var isvalid = false

        this.state.userdata.map((val) => {
            if(userid === val.username && userpass === val.password){
                // VALID
                this.setState({
                    redirect : true // SUPAYA PINDAH PAGE
                })
                isvalid = true
                if(val.role === "user"){
                    return this.props.logUser(val.username)

                }else if(val.role === "admin"){
                    return this.props.logAdmin(val.username)

                }else {

                }
            }
        })

        if(isvalid === false){
            // IS NOT VALID
            window.alert("not valid")
        }
        
    }

    render(){
        const { redirect } = this.state
        if(redirect) {
           return <Redirect to="/" push={true} />
        }
        return (
            
            <div className="container mt-5">
                <div className='row justify-content-center'>
                    <div className="col-md-8">
                        <Paper className="p-5">
                            <h1 className="mb-5">Log In</h1>
                            <input type="text" ref="userIdLog" className="form-control form-control-lg mt-3 mb-3" placeholder="username"></input>
                            <input type="password" ref="userPassLog" className="form-control form-control-lg mt-3 mb-5" placeholder="password"></input>
                            
                            <p className="mb-5" style={{color : "red", fontWeight : "bolder"}}> </p>
                            <input type="button" className="btn btn-outline-success btn-lg mt-3 mb-5" value="Submit" onClick={() => this.validateUser()}></input>
                            <Link to='/pages/register'>
                            <p className="mb-3" style={{textDecoration : "underline", color : "black"}}>Dont Have an Account ? Sign in now </p>
                            </Link>
 
                        </Paper>
                    </div>
                </div>
            </div>
        )
    }
}

const mapStateToProps = (state) => {
    return{
       currentUser : state.CURRENT_USER_DATA.currentUser,
       IS_ADMIN : state.CURRENT_USER_DATA.IS_ADMIN,
       IS_LOGGED_IN : state.CURRENT_USER_DATA.IS_LOGGED_IN
       
    }
}


export default connect(mapStateToProps, {logUser, logAdmin})(loginPage);
